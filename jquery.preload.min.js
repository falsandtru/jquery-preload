/*
 * 
 * preload
 * 
 * ---
 * @Copyright(c) 2014, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.0.2
 * @updated 2014/02/22
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(h,q,r,n){function p(a,g,k,f,e,b){var l=this;switch(!0){case "string"===typeof b:b={link:b};default:l=l instanceof a?l:a(k),l=e.setProperties.call(l,null,null)}var d;d=a.extend(!0,{gns:e.name,ns:f,link:"a:not([target])",filter:function(){return/(\/|\.html?|\.php)([#?].*)?$/.test(this.href)},lock:1E3,interval:1E3,limit:2,cooldown:1E4,query:null,fix:!1,ajax:{async:!0,timeout:2E3}},b);d.nss={array:[e.name].concat(d.ns&&String(d.ns).split(".")||[])};a.extend(!0,d=d.scope&&e.scope(d)||d,{id:0,
nss:{name:d.ns||"",alias:e.alias?[e.alias].concat(d.nss.array.slice(1)).join("."):!1,event:d.nss.array.join("."),data:d.nss.array.join("-"),class4html:d.nss.array.join("-"),click:["click"].concat(d.nss.array.join(":")).join("."),mousemove:["mousemove"].concat(d.nss.array.join(":")).join("."),mouseover:["mouseover"].concat(d.nss.array.join(":")).join("."),mouseout:["mouseout"].concat(d.nss.array.join(":")).join(".")},target:null,volume:0,points:[],queue:[],xhr:null,timestamp:0,option:b});a(function(){e.registrate.call(l,
a,g,k,f,e,d)});return l}var f;f={name:"preload",alias:"",ids:[],settings:[0],count:0,parseHTML:null,setAlias:function(a){f.alias="string"===typeof a?a:f.alias;f.name===f.alias||h[f.alias]||(h[f.name][f.alias]=h.fn[f.name],h.fn[f.alias]=h[f.alias]=h.fn[f.name])},setProperties:function(a,g){var k=this;if(k instanceof h||k===h[f.name])k=k instanceof h&&g!==n?k.add(g):k,k[f.name]=h[f.name];return k},loaded:{},registrate:function(a,g,k,f,e,b){b.id=e.settings.length;e.ids.push(b.id);e.settings[b.id]=b;
f=b.fix?e.canonicalizeURL(g.location.href):g.location.href;e.loaded[f.replace(/#.*/,"")]=!0;this.find(b.link).filter(b.filter).unbind(b.nss.click).one(b.nss.click,b.id,function(b){b=e.settings[b.data];a.data(this,b.nss.data)||(b.xhr&&4>b.xhr.readyState&&b.xhr.abort(),b.fix&&(this.href=e.canonicalizeURL(this.href)))}).unbind(b.nss.mouseover).bind(b.nss.mouseover,b.id,function(a){e.settings[a.data].target=this}).unbind(b.nss.mouseout).bind(b.nss.mouseout,b.id,function(a){e.settings[a.data].target=null}).unbind(b.nss.mousemove).bind(b.nss.mousemove,
b.id,function(b){var d=e.settings[b.data];b.timeStamp=(new Date).getTime();d.points.unshift(b);d.points.splice(10,1);d.target&&function(c,b,d,f){var h,l,m;h=c.fix?e.canonicalizeURL(d.href):d.href;l=c.queue;switch(!0){case !e.settings[c.id]:case e.loaded[h.replace(/#.*/,"")]:case 100<l.length:case c.interval?(new Date).getTime()-c.timestamp<c.interval:0:case c.volume>=c.limit:case c.target!==d:case c.target.protocol!==d.protocol:case c.target.host!==d.host:case a(d).is('[target="_blank"]'):case !function(a){if(3>
a.length)return!1;var c,b,d;b=a[0].timeStamp-a[1].timeStamp;c=Math.pow(a[0].pageX-a[1].pageX,2)+Math.pow(a[0].pageY-a[1].pageY,2)/(b||1);d=a[1].timeStamp-a[2].timeStamp;a=Math.pow(a[1].pageX-a[2].pageX,2)+Math.pow(a[1].pageY-a[2].pageY,2)/(d||1);switch(!0){case 100<b||100<d:return!1;case c<a+Math.pow(5,2)&&c<=Math.pow(25,2):return!0;default:return!1}}(c.points):break;default:for(;m=l.shift();)clearTimeout(m);m=setTimeout(function(){for(;m=l.shift();)clearTimeout(m);switch(!0){case !c.target:case b!==
c.points[0]:case b.pageX!==c.points[0].pageX||b.pageY!==c.points[0].pageY:break;default:e.loaded[h.replace(/#.*/,"")]=!0;++c.volume;c.timestamp=b.timeStamp;c.lock&&(a.data(c.target,c.nss.data,"lock"),a(c.target).unbind(c.nss.click).one(c.nss.click,b.timeStamp,function(b){a(this);var e=Math.max(c.lock-(new Date).getTime()+b.data,0);e&&(a.data(d,c.nss.data,"click"),setTimeout(function(){switch(a.data(b.currentTarget,c.nss.data)){case "click":a(b.currentTarget).removeData(c.nss.data);a(k).find(b.currentTarget)[0]&&
(a(k).unbind(c.nss.click).one(c.nss.click,function(a){a.isDefaultPrevented()||(g.location.href=d.href)}),a(b.currentTarget).click());break;default:a.removeData(b.currentTarget,c.nss.data)}},e),b.preventDefault(),b.stopPropagation())}));var f=a.extend(!0,{},c.ajax,{url:h.replace(/([^#]+)(#[^\s]*)?$/,"$1"+(c.query?(h.match(/\?/)?"&":"?")+c.query:"")+"$2"),beforeSend:function(){c.xhr&&4>c.xhr.readyState&&(c.xhr.abort(),e.loaded[h.replace(/#.*/,"")]=!1);c.xhr=arguments[0];e.fire(c.ajax.beforeSend,this,
arguments)},success:function(){e.fire(c.ajax.success,this,arguments);e.loaded[this.url.replace(/#.*/,"")]=!0;c.volume-=Number(304===arguments[2].status&&!!c.volume);switch(a.data(d,c.nss.data)){case "click":a(d).removeData(c.nss.data);a(k).find(d)[0]&&(a(k).unbind(c.nss.click).one(c.nss.click,function(a){a.isDefaultPrevented()||(g.location.href=d.href)}),a(d).click());break;default:a.removeData(d,c.nss.data)}},error:function(){e.fire(c.ajax.error,this,arguments);c.volume-=Number(!!c.volume);a.removeData(d,
c.nss.data)}});a.ajax(f)}},30);l.push(m)}}(d,b,d.target)});setTimeout(function(){b.volume-=Number(!!b.volume);setTimeout(arguments.callee,b.cooldown)},b.cooldown)},canonicalizeURL:function(a){var g;g=f.trim(a);g=a.replace(/[<>"{}|\\^\[\]`\s].*/,"");g=h("<a/>",{href:a})[0].href;g=/^https?:/i.test(a)?a:"";g=encodeURI(decodeURI(a));return g=g.replace(/(?:%\w+)+/g,function(g){return a.match(g.toLowerCase())||g})},trim:function(a){if(String.prototype.trim)a=String(a).trim();else if(a=String(a).replace(/^\s+/,
""))for(var g=a.length;--g;)if(/\S/.test(a.charAt(g))){a=a.substring(0,g+1);break}return a},fire:function(a,g,f,h){return"function"===typeof a?h?setTimeout(function(){a.apply(g,f)},0):a.apply(g,f):a}};(function(a,f,h,n,e){a.fn[e.name]=a[e.name]=function(){return p.apply(this,[a,f,h,n,e].concat([].slice.call(arguments)))};e.setProperties.call(a[e.name])}).apply(this,[].slice.call(arguments).concat([f]))})(jQuery,window,document,void 0);
