/*
 * 
 * preload
 * 
 * ---
 * @Copyright(c) 2014, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.2.1
 * @updated 2014/06/08
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(f,m,n,p){function q(a,b,d,e,h,c){var f=this;switch(!0){case "string"===typeof c:c={link:c};default:f=f instanceof a?f:a(d),f=h.setProperties.call(f,null,null)}var g;g=a.extend(!0,{gns:h.name,ns:e,observe:!0,link:"a:not([target])",filter:function(){return/(\/[^.]*|\.html?|\.php)([#?].*)?$/.test(this.href)},lock:1E3,forward:null,check:null,interval:1E3,limit:2,cooldown:1E4,skip:50,query:null,encode:!1,prefetch:null,ajax:{dataType:"text",async:!0,timeout:1500}},c);g.nss={array:[h.name].concat(g.ns&&
String(g.ns).split(".")||[])};a.extend(!0,g=g.scope&&h.scope(g)||g,{id:0,nss:{name:g.ns||"",alias:h.alias?[h.alias].concat(g.nss.array.slice(1)).join("."):!1,event:g.nss.array.join("."),data:g.nss.array.join("-"),class4html:g.nss.array.join("-"),click:["click"].concat(g.nss.array.join(":")).join("."),mousemove:["mousemove"].concat(g.nss.array.join(":")).join("."),mouseover:["mouseover"].concat(g.nss.array.join(":")).join("."),mouseout:["mouseout"].concat(g.nss.array.join(":")).join("."),touchstart:["touchstart"].concat(g.nss.array.join(":")).join("."),
touchmove:["touchmove"].concat(g.nss.array.join(":")).join("."),touchend:["touchend"].concat(g.nss.array.join(":")).join(".")},target:null,volume:0,points:[],touch:!1,queue:[],xhr:null,ajax:a.extend(!0,{},a.ajaxSettings,g.ajax),timeStamp:0,option:c});a(function(){h.registrate.call(f,a,b,d,e,h,g)});return f}var e;e={name:"preload",alias:"",ids:[],settings:[0],count:0,disable:!1,setAlias:function(a){e.alias="string"===typeof a?a:e.alias;e.name===e.alias||f[e.alias]||(f[e.name][e.alias]=f.fn[e.name],
f.fn[e.alias]=f[e.alias]=f.fn[e.name])},setProperties:function(a,b){var d=this;if(d instanceof f||d===f[e.name])d=d instanceof f&&b!==p?d.add(b):d,d[e.name]=f[e.name],d.enable=function(){e.disable=!1},d.disable=function(){e.disable=!0};return d},req:{},loaded:{},registrate:function(a,b,d,e,h,c){var f;f=this;c.id=h.settings.length;h.ids.push(c.id);h.settings[c.id]=c;b=c.encode?h.canonicalizeURL(b.location.href):b.location.href;h.loaded[b.replace(/#.*/,"")]=!0;a(d).unbind(c.nss.event).bind(c.nss.event,
function(b){c.volume=0;c.timeStamp=0;f.find(b.target).add(f.filter(b.target)).find(c.link).filter(c.filter).unbind(c.nss.click).one(c.nss.click,c.id,function(b){if(!h.disable){var g=h.settings[b.data];b.timeStamp=(new Date).getTime();g.encode&&("href"in this?this.href=h.getURL(g,this):this.src=h.getURL(g,this));switch(!b.isDefaultPrevented()&&a.data(b.currentTarget,g.nss.data)){case "preload":case "lock":g.forward?(h.getURL(g,b.currentTarget),!1===h.fire(g.forward,null,[b,g.xhr,g.timeStamp])?"lock"===
a.data(b.currentTarget,g.nss.data)?b.preventDefault():(h.click(g,b),a.removeData(b.currentTarget,g.nss.data)):(b.preventDefault(),a.removeData(b.currentTarget,g.nss.data))):"lock"===a.data(b.currentTarget,g.nss.data)?b.preventDefault():(h.click(g,b),a.removeData(b.currentTarget,g.nss.data));break;default:g.xhr&&4>g.xhr.readyState&&g.xhr.abort()}}}).unbind(c.nss.mouseover).bind(c.nss.mouseover,c.id,function(a){h.settings[a.data].target=this}).unbind(c.nss.mouseout).bind(c.nss.mouseout,c.id,function(a){h.settings[a.data].target=
null}).unbind(c.nss.mousemove).bind(c.nss.mousemove,c.id,function(a){var b=h.settings[a.data];a.timeStamp=(new Date).getTime();b.points.unshift(a);b.points.splice(10,1);h.check(b,a,b.target)})});c.observe&&a(d).trigger(c.nss.event);(function(a,b){setTimeout(function(){if(c=h.settings[a])c.volume-=Number(!!c.volume),setTimeout(arguments.callee,b)},b)})(c.id,c.cooldown);c.prefetch&&a(c.prefetch).each(function(){h.prefetch.call(this)})},check:function(a,b,d,k){var h,c,l;if(d)switch(h=e.getURL(a,b.currentTarget),
c=a.queue,!0){case !e.settings[a.id]:case 100<c.length:case a.interval?(new Date).getTime()-a.timeStamp<a.interval:0:case a.volume>=a.limit:case a.target!==d:case a.target.protocol!==d.protocol:case a.target.host!==d.host:case f(d).is('[target="_blank"]'):case a.check?!!e.fire(a.check,b.currentTarget,[h]):e.loaded[h.replace(/#.*/,"")]:case !function(a){if(3>a.length)return!1;var b,c,d;c=a[0].timeStamp-a[1].timeStamp;b=Math.pow(a[0].pageX-a[1].pageX,2)+Math.pow(a[0].pageY-a[1].pageY,2)/(c||1);d=a[1].timeStamp-
a[2].timeStamp;a=Math.pow(a[1].pageX-a[2].pageX,2)+Math.pow(a[1].pageY-a[2].pageY,2)/(d||1);switch(!0){case 100<c||100<d:return!1;case b<a+Math.pow(5,2)&&b<=Math.pow(25,2):return!0;default:return!1}}(a.points):break;default:for(;l=c.shift();)clearTimeout(l);l=setTimeout(function(){for(;l=c.shift();)clearTimeout(l);switch(!0){case !a.target:case b!==a.points[0]:case b.pageX!==a.points[0].pageX||b.pageY!==a.points[0].pageY:case !a.ajax.crossDomain&&a.target.protocol!==m.location.protocol:case !a.ajax.crossDomain&&
a.target.host!==m.location.host:break;default:a.xhr&&4>a.xhr.readyState&&a.xhr.abort(),e.loaded[h.replace(/#.*/,"")]=!0,++a.volume,a.timeStamp=b.timeStamp,f.data(d,a.nss.data,"preload"),a.lock&&(f.data(a.target,a.nss.data,"lock"),f(a.target).one(a.nss.click,b.timeStamp,function(b){if(f.data(b.currentTarget,a.nss.data)){f(this);var c=Math.max(a.lock-(new Date).getTime()+b.data,0);f.data(b.currentTarget,a.nss.data,"click");c&&(setTimeout(function(){"click"===f.data(b.currentTarget,a.nss.data)&&e.click(a,
b);f.removeData(b.currentTarget,a.nss.data)},c),b.preventDefault())}})),e.preload(a,b)}},30);c.push(l)}},preload:function(a,b){var d=f.extend(!0,{},a.ajax,{success:function(){c=(new Date).getTime()-c;e.fire(a.ajax.success,this,arguments);e.loaded[this.url.replace(/#.*/,"")]=!0;for(var d in e.req){var g=e.req[d];g&&4>g.readyState&&(g.abort(),e.req[d]=null)}if(304===arguments[2].status||c<=a.skip)a.volume-=Number(!!a.volume),a.timeStamp=0;if("click"===f.data(b.currentTarget,a.nss.data))e.click(a,b);
else{var k;a.prefetch&&(k={async:!0,dataType:"text",success:function(){e.loaded[this.url]=!0;e.req[h]=null}},d=f(arguments[0]),d.filter(a.prefetch).add(d.find(a.prefetch)).each(function(){e.prefetch.call(this,a,k)}))}f.removeData(b.currentTarget,a.nss.data)},error:function(){e.fire(a.ajax.error,this,arguments);a.volume-=Number(!!a.volume);a.timeStamp=0;f.removeData(b.currentTarget,a.nss.data)}}),k=a.query;k&&(k=k.split("="),k=encodeURIComponent(k[0])+(0<k.length?"="+encodeURIComponent(k[1]):""));
var h=e.getURL(a,b.currentTarget);d.url=h.replace(/([^#]+)(#[^\s]*)?$/,"$1"+(k?(h.match(/\?/)?"&":"?")+k:"")+"$2");var c=(new Date).getTime();a.xhr=f.ajax(d)},click:function(a,b){var d=b.currentTarget;a.xhr&&4>a.xhr.readyState&&a.xhr.abort();f(b.currentTarget).removeData(a.nss.data);f(n).find(b.currentTarget)[0]&&(f(n).unbind(a.nss.click).one(a.nss.click,function(b){b.isDefaultPrevented()||(m.location.href=a.encode?e.canonicalizeURL(d.href):d.href,a.encode&&(m.location.href=e.getURL(a,this)))}),f(b.currentTarget).click());
b.preventDefault()},prefetch:function(a,b){var d=e.getURL(a,this);b?d&&!e.loaded[d]&&(b.url=d,e.req[d]=f.ajax(b)):e.loaded[d]=!0},getURL:function(a,b){var d;switch(b.tagName.toLowerCase()){case "a":case "link":d=b.href;break;case "script":case "img":case "iframe":d=b.src}return a.encode?e.canonicalizeURL(d):d},canonicalizeURL:function(a){var b;b=e.trim(a);b=b.replace(/["`^|\\<>{}\[\]\s].*/,"");b=/^https?:/i.test(b)?b:f("<a/>",{href:b})[0].href;b=encodeURI(decodeURI(b));return b=b.replace(/(?:%\w{2})+/g,
function(b){return a.match(b.toLowerCase())||b})},trim:function(a){if(String.prototype.trim)a=String(a).trim();else if(a=String(a).replace(/^[\s\uFEFF\xA0]+/,""))for(var b=a.length;--b;)if(/[^\s\uFEFF\xA0]/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a},fire:function(a,b,d,e){return"function"===typeof a?e?setTimeout(function(){a.apply(b,d)},0):a.apply(b,d):a}};(function(a,b,d,e,f){a.fn[f.name]=a[f.name]=function(){return q.apply(this,[a,b,d,e,f].concat([].slice.call(arguments)))};f.setProperties.call(a[f.name])}).apply(this,
[].slice.call(arguments).concat([e]))})(jQuery,window,document,void 0);
