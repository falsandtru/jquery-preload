/*
 * 
 * preload
 * 
 * ---
 * @Copyright(c) 2014, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.1.3
 * @updated 2014/02/23
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(f,n,m,p){function q(a,b,d,f,g,c){var k=this;switch(!0){case "string"===typeof c:c={link:c};default:k=k instanceof a?k:a(d),k=g.setProperties.call(k,null,null)}var e;e=a.extend(!0,{gns:g.name,ns:f,link:"a:not([target])",filter:function(){return/(\/|\.html?|\.php)([#?].*)?$/.test(this.href)},lock:1E3,forward:null,interval:1E3,limit:2,cooldown:1E4,query:null,encode:!1,prefetch:null,ajax:{dataType:"text",async:!0,timeout:1500}},c);e.nss={array:[g.name].concat(e.ns&&String(e.ns).split(".")||
[])};a.extend(!0,e=e.scope&&g.scope(e)||e,{id:0,nss:{name:e.ns||"",alias:g.alias?[g.alias].concat(e.nss.array.slice(1)).join("."):!1,event:e.nss.array.join("."),data:e.nss.array.join("-"),class4html:e.nss.array.join("-"),cmd:["cmd"].concat(e.nss.array.join(":")).join("."),click:["click"].concat(e.nss.array.join(":")).join("."),mousemove:["mousemove"].concat(e.nss.array.join(":")).join("."),mouseover:["mouseover"].concat(e.nss.array.join(":")).join("."),mouseout:["mouseout"].concat(e.nss.array.join(":")).join(".")},
target:null,volume:0,points:[],queue:[],xhr:null,timestamp:0,option:c});a(function(){g.registrate.call(k,a,b,d,f,g,e)});return k}var d;d={name:"preload",alias:"",ids:[],settings:[0],count:0,parseHTML:null,setAlias:function(a){d.alias="string"===typeof a?a:d.alias;d.name===d.alias||f[d.alias]||(f[d.name][d.alias]=f.fn[d.name],f.fn[d.alias]=f[d.alias]=f.fn[d.name])},setProperties:function(a,b){var h=this;if(h instanceof f||h===f[d.name])h=h instanceof f&&b!==p?h.add(b):h,h[d.name]=f[d.name];return h},
req:{},loaded:{},registrate:function(a,b,d,f,g,c){c.id=g.settings.length;g.ids.push(c.id);g.settings[c.id]=c;b=c.encode?g.canonicalizeURL(b.location.href):b.location.href;g.loaded[b.replace(/#.*/,"")]=!0;this.find(c.link).filter(c.filter).unbind(c.nss.click).one(c.nss.click,c.id,function(b){var e=g.settings[b.data];b.timeStamp=(new Date).getTime();e.encode&&(this.href=g.canonicalizeURL(this.href));switch(!b.isDefaultPrevented()&&a.data(b.currentTarget,e.nss.data)){case "preload":case "lock":e.forward?
(e.encode&&g.canonicalizeURL(b.currentTarget.href),!1===g.fire(e.forward,null,[b,e.xhr,e.timeStamp])?"lock"===a.data(b.currentTarget,e.nss.data)?b.preventDefault():(g.click(e,b),a.removeData(b.currentTarget,e.nss.data)):(b.preventDefault(),a.removeData(b.currentTarget,e.nss.data))):"lock"===a.data(b.currentTarget,e.nss.data)?b.preventDefault():(g.click(e,b),a.removeData(b.currentTarget,e.nss.data));break;default:e.xhr&&4>e.xhr.readyState&&e.xhr.abort()}}).unbind(c.nss.mouseover).bind(c.nss.mouseover,
c.id,function(a){g.settings[a.data].target=this}).unbind(c.nss.mouseout).bind(c.nss.mouseout,c.id,function(a){g.settings[a.data].target=null}).unbind(c.nss.mousemove).bind(c.nss.mousemove,c.id,function(a){var b=g.settings[a.data];a.timeStamp=(new Date).getTime();b.points.unshift(a);b.points.splice(10,1);g.check(b,a,b.target)});a(d).trigger(c.nss.cmd).one(c.nss.cmd,c.id,function(a){g.settings[a.data]=f});(function(a,b){setTimeout(function(){if(c=g.settings[a])c.volume-=Number(!!c.volume),setTimeout(arguments.callee,
b)},b)})(c.id,c.cooldown);c.prefetch&&a(c.prefetch).each(function(){g.prefetch.call(this)})},check:function(a,b,h,r){var g,c,k;if(h)switch(g=a.encode?d.canonicalizeURL(b.currentTarget.href):b.currentTarget.href,c=a.queue,!0){case !d.settings[a.id]:case d.loaded[g.replace(/#.*/,"")]:case 100<c.length:case a.interval?(new Date).getTime()-a.timestamp<a.interval:0:case a.volume>=a.limit:case a.target!==h:case a.target.protocol!==h.protocol:case a.target.host!==h.host:case f(h).is('[target="_blank"]'):case !function(a){if(3>
a.length)return!1;var b,c,d;c=a[0].timeStamp-a[1].timeStamp;b=Math.pow(a[0].pageX-a[1].pageX,2)+Math.pow(a[0].pageY-a[1].pageY,2)/(c||1);d=a[1].timeStamp-a[2].timeStamp;a=Math.pow(a[1].pageX-a[2].pageX,2)+Math.pow(a[1].pageY-a[2].pageY,2)/(d||1);switch(!0){case 100<c||100<d:return!1;case b<a+Math.pow(5,2)&&b<=Math.pow(25,2):return!0;default:return!1}}(a.points):break;default:for(;k=c.shift();)clearTimeout(k);k=setTimeout(function(){for(;k=c.shift();)clearTimeout(k);switch(!0){case !a.target:case b!==
a.points[0]:case b.pageX!==a.points[0].pageX||b.pageY!==a.points[0].pageY:break;default:a.xhr&&4>a.xhr.readyState&&a.xhr.abort();d.loaded[g.replace(/#.*/,"")]=!0;++a.volume;a.timeStamp=b.timeStamp;f.data(a.target,a.nss.data,"preload");a.lock&&(f.data(a.target,a.nss.data,"lock"),f(a.target).one(a.nss.click,b.timeStamp,function(b){if(f.data(b.currentTarget,a.nss.data)){f(this);var c=Math.max(a.lock-(new Date).getTime()+b.data,0);f.data(b.currentTarget,a.nss.data,"click");c&&(setTimeout(function(){"click"===
f.data(b.currentTarget,a.nss.data)&&d.click(a,b);f.removeData(b.currentTarget,a.nss.data)},c),b.preventDefault())}}));var e=f.extend(!0,{},a.ajax,{success:function(){d.fire(a.ajax.success,this,arguments);d.loaded[this.url.replace(/#.*/,"")]=!0;for(var c in d.req){var e=d.req[c];e&&4>e.readyState&&(e.abort(),d.req[c]=null)}a.volume-=Number(304===arguments[2].status&&!!a.volume);if("click"===f.data(b.currentTarget,a.nss.data))d.click(a,b);else{var h;a.prefetch&&(h={async:!0,dataType:"text",success:function(){d.loaded[this.url]=
!0;d.req[g]=null}},c=f(arguments[0]),c.filter(a.prefetch).add(c.find(a.prefetch)).each(function(){d.prefetch.call(this,h)}))}f.removeData(b.currentTarget,a.nss.data)},error:function(){d.fire(a.ajax.error,this,arguments);a.volume-=Number(!!a.volume);f.removeData(h,a.nss.data)}}),l=a.query;l&&(l=l.split("="),l=encodeURIComponent(l[0])+(0<l.length?"="+encodeURIComponent(l[1]):""));e.url=g.replace(/([^#]+)(#[^\s]*)?$/,"$1"+(l?(g.match(/\?/)?"&":"?")+l:"")+"$2");a.xhr=f.ajax(e)}},30);c.push(k)}},click:function(a,
b){var h=b.currentTarget;a.xhr&&4>a.xhr.readyState&&a.xhr.abort();f(b.currentTarget).removeData(a.nss.data);f(m).find(b.currentTarget)[0]&&(f(m).unbind(a.nss.click).one(a.nss.click,function(b){b.isDefaultPrevented()||(n.location.href=a.encode?d.canonicalizeURL(h.href):h.href)}),f(b.currentTarget).click());b.preventDefault()},prefetch:function(a){var b;switch(this.tagName.toLowerCase()){case "link":b=this.href;break;case "script":case "img":case "iframe":b=this.src}a?b&&!d.loaded[b]&&(a.url=b,d.req[b]=
f.ajax(a)):d.loaded[b]=!0},canonicalizeURL:function(a){var b;b=d.trim(a);b=b.replace(/[<>"{}|\\^\[\]`\s].*/,"");b=/^https?:/i.test(b)?b:f("<a/>",{href:b})[0].href;b=encodeURI(decodeURI(b));return b=b.replace(/(?:%\w{2})+/g,function(b){return a.match(b.toLowerCase())||b})},trim:function(a){if(String.prototype.trim)a=String(a).trim();else if(a=String(a).replace(/^\s+/,""))for(var b=a.length;--b;)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a},fire:function(a,b,d,f){return"function"===
typeof a?f?setTimeout(function(){a.apply(b,d)},0):a.apply(b,d):a}};(function(a,b,d,f,g){a.fn[g.name]=a[g.name]=function(){return q.apply(this,[a,b,d,f,g].concat([].slice.call(arguments)))};g.setProperties.call(a[g.name])}).apply(this,[].slice.call(arguments).concat([d]))})(jQuery,window,document,void 0);
