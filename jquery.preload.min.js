/*
 * 
 * preload
 * 
 * ---
 * @Copyright(c) 2014, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.1.2
 * @updated 2014/02/23
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(g,n,m,p){function q(a,b,c,g,d,f){var k=this;switch(!0){case "string"===typeof f:f={link:f};default:k=k instanceof a?k:a(c),k=d.setProperties.call(k,null,null)}var e;e=a.extend(!0,{gns:d.name,ns:g,link:"a:not([target])",filter:function(){return/(\/|\.html?|\.php)([#?].*)?$/.test(this.href)},lock:1E3,forward:null,interval:1E3,limit:2,cooldown:1E4,query:null,encode:!1,prefetch:null,ajax:{dataType:"text",async:!0,timeout:1500}},f);e.nss={array:[d.name].concat(e.ns&&String(e.ns).split(".")||
[])};a.extend(!0,e=e.scope&&d.scope(e)||e,{id:0,nss:{name:e.ns||"",alias:d.alias?[d.alias].concat(e.nss.array.slice(1)).join("."):!1,event:e.nss.array.join("."),data:e.nss.array.join("-"),class4html:e.nss.array.join("-"),click:["click"].concat(e.nss.array.join(":")).join("."),mousemove:["mousemove"].concat(e.nss.array.join(":")).join("."),mouseover:["mouseover"].concat(e.nss.array.join(":")).join("."),mouseout:["mouseout"].concat(e.nss.array.join(":")).join(".")},target:null,volume:0,points:[],queue:[],
xhr:null,timestamp:0,option:f});a(function(){d.registrate.call(k,a,b,c,g,d,e)});return k}var c;c={name:"preload",alias:"",ids:[],settings:[0],count:0,parseHTML:null,setAlias:function(a){c.alias="string"===typeof a?a:c.alias;c.name===c.alias||g[c.alias]||(g[c.name][c.alias]=g.fn[c.name],g.fn[c.alias]=g[c.alias]=g.fn[c.name])},setProperties:function(a,b){var h=this;if(h instanceof g||h===g[c.name])h=h instanceof g&&b!==p?h.add(b):h,h[c.name]=g[c.name];return h},req:{},loaded:{},registrate:function(a,
b,c,g,d,f){f.id=d.settings.length;d.ids.push(f.id);d.settings[f.id]=f;b=f.encode?d.canonicalizeURL(b.location.href):b.location.href;d.loaded[b.replace(/#.*/,"")]=!0;this.find(f.link).filter(f.filter).unbind(f.nss.click).one(f.nss.click,f.id,function(b){var e=d.settings[b.data];b.timeStamp=(new Date).getTime();e.encode&&(this.href=d.canonicalizeURL(this.href));switch(!b.isDefaultPrevented()&&a.data(b.currentTarget,e.nss.data)){case "preload":case "lock":e.forward?(e.encode&&d.canonicalizeURL(b.currentTarget.href),
!1===d.fire(e.forward,null,[b,e.xhr,e.timeStamp])?"lock"===a.data(b.currentTarget,e.nss.data)?b.preventDefault():(d.click(e,b),a.removeData(b.currentTarget,e.nss.data)):(b.preventDefault(),a.removeData(b.currentTarget,e.nss.data))):"lock"===a.data(b.currentTarget,e.nss.data)?b.preventDefault():(d.click(e,b),a.removeData(b.currentTarget,e.nss.data));break;default:e.xhr&&4>e.xhr.readyState&&e.xhr.abort()}}).unbind(f.nss.mouseover).bind(f.nss.mouseover,f.id,function(a){d.settings[a.data].target=this}).unbind(f.nss.mouseout).bind(f.nss.mouseout,
f.id,function(a){d.settings[a.data].target=null}).unbind(f.nss.mousemove).bind(f.nss.mousemove,f.id,function(a){var b=d.settings[a.data];a.timeStamp=(new Date).getTime();b.points.unshift(a);b.points.splice(10,1);d.check(b,a,b.target)});setTimeout(function(){f.volume-=Number(!!f.volume);setTimeout(arguments.callee,f.cooldown)},f.cooldown);f.prefetch&&a(f.prefetch).each(function(){d.prefetch.call(this)})},check:function(a,b,h,r){var d,f,k;if(h)switch(d=a.encode?c.canonicalizeURL(b.currentTarget.href):
b.currentTarget.href,f=a.queue,!0){case !c.settings[a.id]:case c.loaded[d.replace(/#.*/,"")]:case 100<f.length:case a.interval?(new Date).getTime()-a.timestamp<a.interval:0:case a.volume>=a.limit:case a.target!==h:case a.target.protocol!==h.protocol:case a.target.host!==h.host:case g(h).is('[target="_blank"]'):case !function(a){if(3>a.length)return!1;var b,c,d;c=a[0].timeStamp-a[1].timeStamp;b=Math.pow(a[0].pageX-a[1].pageX,2)+Math.pow(a[0].pageY-a[1].pageY,2)/(c||1);d=a[1].timeStamp-a[2].timeStamp;
a=Math.pow(a[1].pageX-a[2].pageX,2)+Math.pow(a[1].pageY-a[2].pageY,2)/(d||1);switch(!0){case 100<c||100<d:return!1;case b<a+Math.pow(5,2)&&b<=Math.pow(25,2):return!0;default:return!1}}(a.points):break;default:for(;k=f.shift();)clearTimeout(k);k=setTimeout(function(){for(;k=f.shift();)clearTimeout(k);switch(!0){case !a.target:case b!==a.points[0]:case b.pageX!==a.points[0].pageX||b.pageY!==a.points[0].pageY:break;default:a.xhr&&4>a.xhr.readyState&&a.xhr.abort();c.loaded[d.replace(/#.*/,"")]=!0;++a.volume;
a.timeStamp=b.timeStamp;g.data(a.target,a.nss.data,"preload");a.lock&&(g.data(a.target,a.nss.data,"lock"),g(a.target).one(a.nss.click,b.timeStamp,function(b){if(g.data(b.currentTarget,a.nss.data)){g(this);var d=Math.max(a.lock-(new Date).getTime()+b.data,0);g.data(b.currentTarget,a.nss.data,"click");d&&(setTimeout(function(){"click"===g.data(b.currentTarget,a.nss.data)&&c.click(a,b);g.removeData(b.currentTarget,a.nss.data)},d),b.preventDefault())}}));var e=g.extend(!0,{},a.ajax,{success:function(){c.fire(a.ajax.success,
this,arguments);c.loaded[this.url.replace(/#.*/,"")]=!0;for(var e in c.req){var f=c.req[e];f&&4>f.readyState&&(f.abort(),c.req[e]=null)}a.volume-=Number(304===arguments[2].status&&!!a.volume);if("click"===g.data(b.currentTarget,a.nss.data))c.click(a,b);else{var h;a.prefetch&&(h={async:!0,dataType:"text",success:function(){c.loaded[this.url]=!0;c.req[d]=null}},e=g(arguments[0]),e.filter(a.prefetch).add(e.find(a.prefetch)).each(function(){c.prefetch.call(this,h)}))}g.removeData(b.currentTarget,a.nss.data)},
error:function(){c.fire(a.ajax.error,this,arguments);a.volume-=Number(!!a.volume);g.removeData(h,a.nss.data)}}),l=a.query;l&&(l=l.split("="),l=encodeURIComponent(l[0])+(0<l.length?"="+encodeURIComponent(l[1]):""));e.url=d.replace(/([^#]+)(#[^\s]*)?$/,"$1"+(l?(d.match(/\?/)?"&":"?")+l:"")+"$2");a.xhr=g.ajax(e)}},30);f.push(k)}},click:function(a,b){var h=b.currentTarget;a.xhr&&4>a.xhr.readyState&&a.xhr.abort();g(b.currentTarget).removeData(a.nss.data);g(m).find(b.currentTarget)[0]&&(g(m).unbind(a.nss.click).one(a.nss.click,
function(b){b.isDefaultPrevented()||(n.location.href=a.encode?c.canonicalizeURL(h.href):h.href)}),g(b.currentTarget).click());b.preventDefault()},prefetch:function(a){var b;switch(this.tagName.toLowerCase()){case "link":b=this.href;break;case "script":case "img":case "iframe":b=this.src}a?b&&!c.loaded[b]&&(a.url=b,c.req[b]=g.ajax(a)):c.loaded[b]=!0},canonicalizeURL:function(a){var b;b=c.trim(a);b=b.replace(/[<>"{}|\\^\[\]`\s].*/,"");b=/^https?:/i.test(b)?b:g("<a/>",{href:b})[0].href;b=encodeURI(decodeURI(b));
return b=b.replace(/(?:%\w{2})+/g,function(b){return a.match(b.toLowerCase())||b})},trim:function(a){if(String.prototype.trim)a=String(a).trim();else if(a=String(a).replace(/^\s+/,""))for(var b=a.length;--b;)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a},fire:function(a,b,c,g){return"function"===typeof a?g?setTimeout(function(){a.apply(b,c)},0):a.apply(b,c):a}};(function(a,b,c,g,d){a.fn[d.name]=a[d.name]=function(){return q.apply(this,[a,b,c,g,d].concat([].slice.call(arguments)))};
d.setProperties.call(a[d.name])}).apply(this,[].slice.call(arguments).concat([c]))})(jQuery,window,document,void 0);
