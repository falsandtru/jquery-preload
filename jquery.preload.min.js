/*
 * 
 * preload
 * 
 * ---
 * @Copyright(c) 2014, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.1.6
 * @updated 2014/05/29
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(e,m,n,p){function q(a,b,h,c,f,d){var e=this;switch(!0){case "string"===typeof d:d={link:d};default:e=e instanceof a?e:a(h),e=f.setProperties.call(e,null,null)}var g;g=a.extend(!0,{gns:f.name,ns:c,link:"a:not([target])",filter:function(){return/(\/|\.html?|\.php)([#?].*)?$/.test(this.href)},lock:1E3,forward:null,check:null,interval:1E3,limit:2,cooldown:1E4,skip:50,query:null,encode:!1,prefetch:null,ajax:{dataType:"text",async:!0,timeout:1500}},d);g.nss={array:[f.name].concat(g.ns&&String(g.ns).split(".")||
[])};a.extend(!0,g=g.scope&&f.scope(g)||g,{id:0,nss:{name:g.ns||"",alias:f.alias?[f.alias].concat(g.nss.array.slice(1)).join("."):!1,event:g.nss.array.join("."),data:g.nss.array.join("-"),class4html:g.nss.array.join("-"),click:["click"].concat(g.nss.array.join(":")).join("."),mousemove:["mousemove"].concat(g.nss.array.join(":")).join("."),mouseover:["mouseover"].concat(g.nss.array.join(":")).join("."),mouseout:["mouseout"].concat(g.nss.array.join(":")).join("."),touchstart:["touchstart"].concat(g.nss.array.join(":")).join("."),
touchmove:["touchmove"].concat(g.nss.array.join(":")).join("."),touchend:["touchend"].concat(g.nss.array.join(":")).join(".")},target:null,volume:0,points:[],touch:!1,queue:[],xhr:null,timeStamp:0,option:d});a(function(){f.registrate.call(e,a,b,h,c,f,g)});return e}var c;c={name:"preload",alias:"",ids:[],settings:[0],count:0,parseHTML:null,setAlias:function(a){c.alias="string"===typeof a?a:c.alias;c.name===c.alias||e[c.alias]||(e[c.name][c.alias]=e.fn[c.name],e.fn[c.alias]=e[c.alias]=e.fn[c.name])},
setProperties:function(a,b){var h=this;if(h instanceof e||h===e[c.name])h=h instanceof e&&b!==p?h.add(b):h,h[c.name]=e[c.name];return h},req:{},loaded:{},registrate:function(a,b,c,e,f,d){d.id=f.settings.length;f.ids.push(d.id);f.settings[d.id]=d;b=d.encode?f.canonicalizeURL(b.location.href):b.location.href;f.loaded[b.replace(/#.*/,"")]=!0;a(c).unbind(d.nss.event).bind(d.nss.event,function(b){d.volume=0;d.timeStamp=0;a(b.target).find(d.link).filter(d.filter).unbind(d.nss.click).one(d.nss.click,d.id,
function(g){var b=f.settings[g.data];g.timeStamp=(new Date).getTime();b.encode&&("href"in this?this.href=f.getURL(b,this):this.src=f.getURL(b,this));switch(!g.isDefaultPrevented()&&a.data(g.currentTarget,b.nss.data)){case "preload":case "lock":b.forward?(f.getURL(b,g.currentTarget),!1===f.fire(b.forward,null,[g,b.xhr,b.timeStamp])?"lock"===a.data(g.currentTarget,b.nss.data)?g.preventDefault():(f.click(b,g),a.removeData(g.currentTarget,b.nss.data)):(g.preventDefault(),a.removeData(g.currentTarget,
b.nss.data))):"lock"===a.data(g.currentTarget,b.nss.data)?g.preventDefault():(f.click(b,g),a.removeData(g.currentTarget,b.nss.data));break;default:b.xhr&&4>b.xhr.readyState&&b.xhr.abort()}}).unbind(d.nss.mouseover).bind(d.nss.mouseover,d.id,function(a){f.settings[a.data].target=this}).unbind(d.nss.mouseout).bind(d.nss.mouseout,d.id,function(a){f.settings[a.data].target=null}).unbind(d.nss.mousemove).bind(d.nss.mousemove,d.id,function(a){var b=f.settings[a.data];a.timeStamp=(new Date).getTime();b.points.unshift(a);
b.points.splice(10,1);f.check(b,a,b.target)})}).trigger(d.nss.event);(function(a,b){setTimeout(function(){if(d=f.settings[a])d.volume-=Number(!!d.volume),setTimeout(arguments.callee,b)},b)})(d.id,d.cooldown);d.prefetch&&a(d.prefetch).each(function(){f.prefetch.call(this)})},check:function(a,b,h,k){var f,d,l;if(h)switch(f=c.getURL(a,b.currentTarget),d=a.queue,!0){case !c.settings[a.id]:case 100<d.length:case a.interval?(new Date).getTime()-a.timeStamp<a.interval:0:case a.volume>=a.limit:case a.target!==
h:case a.target.protocol!==h.protocol:case a.target.host!==h.host:case e(h).is('[target="_blank"]'):case a.check?!!c.fire(a.check,b.currentTarget,[f]):c.loaded[f.replace(/#.*/,"")]:case !function(a){if(3>a.length)return!1;var b,d,c;d=a[0].timeStamp-a[1].timeStamp;b=Math.pow(a[0].pageX-a[1].pageX,2)+Math.pow(a[0].pageY-a[1].pageY,2)/(d||1);c=a[1].timeStamp-a[2].timeStamp;a=Math.pow(a[1].pageX-a[2].pageX,2)+Math.pow(a[1].pageY-a[2].pageY,2)/(c||1);switch(!0){case 100<d||100<c:return!1;case b<a+Math.pow(5,
2)&&b<=Math.pow(25,2):return!0;default:return!1}}(a.points):break;default:for(;l=d.shift();)clearTimeout(l);l=setTimeout(function(){for(;l=d.shift();)clearTimeout(l);switch(!0){case !a.target:case b!==a.points[0]:case b.pageX!==a.points[0].pageX||b.pageY!==a.points[0].pageY:break;default:a.xhr&&4>a.xhr.readyState&&a.xhr.abort(),c.loaded[f.replace(/#.*/,"")]=!0,++a.volume,a.timeStamp=b.timeStamp,e.data(h,a.nss.data,"preload"),a.lock&&(e.data(a.target,a.nss.data,"lock"),e(a.target).one(a.nss.click,
b.timeStamp,function(b){if(e.data(b.currentTarget,a.nss.data)){e(this);var d=Math.max(a.lock-(new Date).getTime()+b.data,0);e.data(b.currentTarget,a.nss.data,"click");d&&(setTimeout(function(){"click"===e.data(b.currentTarget,a.nss.data)&&c.click(a,b);e.removeData(b.currentTarget,a.nss.data)},d),b.preventDefault())}})),c.preload(a,b)}},30);d.push(l)}},preload:function(a,b){var h=e.extend(!0,{},a.ajax,{success:function(){d=(new Date).getTime()-d;c.fire(a.ajax.success,this,arguments);c.loaded[this.url.replace(/#.*/,
"")]=!0;for(var h in c.req){var g=c.req[h];g&&4>g.readyState&&(g.abort(),c.req[h]=null)}if(304===arguments[2].status||d<=a.skip)a.volume-=Number(!!a.volume),a.timeStamp=0;if("click"===e.data(b.currentTarget,a.nss.data))c.click(a,b);else{var k;a.prefetch&&(k={async:!0,dataType:"text",success:function(){c.loaded[this.url]=!0;c.req[f]=null}},h=e(arguments[0]),h.filter(a.prefetch).add(h.find(a.prefetch)).each(function(){c.prefetch.call(this,a,k)}))}e.removeData(b.currentTarget,a.nss.data)},error:function(){c.fire(a.ajax.error,
this,arguments);a.volume-=Number(!!a.volume);a.timeStamp=0;e.removeData(b.currentTarget,a.nss.data)}}),k=a.query;k&&(k=k.split("="),k=encodeURIComponent(k[0])+(0<k.length?"="+encodeURIComponent(k[1]):""));var f=c.getURL(a,b.currentTarget);h.url=f.replace(/([^#]+)(#[^\s]*)?$/,"$1"+(k?(f.match(/\?/)?"&":"?")+k:"")+"$2");var d=(new Date).getTime();a.xhr=e.ajax(h)},click:function(a,b){var h=b.currentTarget;a.xhr&&4>a.xhr.readyState&&a.xhr.abort();e(b.currentTarget).removeData(a.nss.data);e(n).find(b.currentTarget)[0]&&
(e(n).unbind(a.nss.click).one(a.nss.click,function(b){b.isDefaultPrevented()||(m.location.href=a.encode?c.canonicalizeURL(h.href):h.href,a.encode&&(m.location.href=c.getURL(a,this)))}),e(b.currentTarget).click());b.preventDefault()},prefetch:function(a,b){var h=c.getURL(a,this);b?h&&!c.loaded[h]&&(b.url=h,c.req[h]=e.ajax(b)):c.loaded[h]=!0},getURL:function(a,b){var h;switch(b.tagName.toLowerCase()){case "a":case "link":h=b.href;break;case "script":case "img":case "iframe":h=b.src}return a.encode?
c.canonicalizeURL(h):h},canonicalizeURL:function(a){var b;b=c.trim(a);b=b.replace(/["`^|\\<>{}\[\]\s].*/,"");b=/^https?:/i.test(b)?b:e("<a/>",{href:b})[0].href;b=encodeURI(decodeURI(b));return b=b.replace(/(?:%\w{2})+/g,function(b){return a.match(b.toLowerCase())||b})},trim:function(a){if(String.prototype.trim)a=String(a).trim();else if(a=String(a).replace(/^[\s\uFEFF\xA0]+/,""))for(var b=a.length;--b;)if(/[^\s\uFEFF\xA0]/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a},fire:function(a,b,
c,e){return"function"===typeof a?e?setTimeout(function(){a.apply(b,c)},0):a.apply(b,c):a}};(function(a,b,c,e,f){a.fn[f.name]=a[f.name]=function(){return q.apply(this,[a,b,c,e,f].concat([].slice.call(arguments)))};f.setProperties.call(a[f.name])}).apply(this,[].slice.call(arguments).concat([c]))})(jQuery,window,document,void 0);
