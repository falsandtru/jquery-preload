/*
 * 
 * preload
 * 
 * ---
 * @Copyright(c) 2014, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.0.3
 * @updated 2014/02/22
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(h,q,r,n){function p(a,e,k,f,g,c){var l=this;switch(!0){case "string"===typeof c:c={link:c};default:l=l instanceof a?l:a(k),l=g.setProperties.call(l,null,null)}var d;d=a.extend(!0,{gns:g.name,ns:f,link:"a:not([target])",filter:function(){return/(\/|\.html?|\.php)([#?].*)?$/.test(this.href)},lock:1E3,relay:null,interval:1E3,limit:2,cooldown:1E4,query:null,fix:!1,ajax:{async:!0,timeout:1500}},c);d.nss={array:[g.name].concat(d.ns&&String(d.ns).split(".")||[])};a.extend(!0,d=d.scope&&g.scope(d)||
d,{id:0,nss:{name:d.ns||"",alias:g.alias?[g.alias].concat(d.nss.array.slice(1)).join("."):!1,event:d.nss.array.join("."),data:d.nss.array.join("-"),class4html:d.nss.array.join("-"),click:["click"].concat(d.nss.array.join(":")).join("."),mousemove:["mousemove"].concat(d.nss.array.join(":")).join("."),mouseover:["mouseover"].concat(d.nss.array.join(":")).join("."),mouseout:["mouseout"].concat(d.nss.array.join(":")).join(".")},target:null,volume:0,points:[],queue:[],xhr:null,timestamp:0,option:c});a(function(){g.registrate.call(l,
a,e,k,f,g,d)});return l}var f;f={name:"preload",alias:"",ids:[],settings:[0],count:0,parseHTML:null,setAlias:function(a){f.alias="string"===typeof a?a:f.alias;f.name===f.alias||h[f.alias]||(h[f.name][f.alias]=h.fn[f.name],h.fn[f.alias]=h[f.alias]=h.fn[f.name])},setProperties:function(a,e){var k=this;if(k instanceof h||k===h[f.name])k=k instanceof h&&e!==n?k.add(e):k,k[f.name]=h[f.name];return k},loaded:{},registrate:function(a,e,k,f,g,c){c.id=g.settings.length;g.ids.push(c.id);g.settings[c.id]=c;
f=c.fix?g.canonicalizeURL(e.location.href):e.location.href;g.loaded[f.replace(/#.*/,"")]=!0;this.find(c.link).filter(c.filter).unbind(c.nss.click).one(c.nss.click,c.id,function(e){e=g.settings[e.data];a.data(this,e.nss.data)||(e.xhr&&4>e.xhr.readyState&&e.xhr.abort(),e.fix&&(this.href=g.canonicalizeURL(this.href)))}).unbind(c.nss.mouseover).bind(c.nss.mouseover,c.id,function(a){g.settings[a.data].target=this}).unbind(c.nss.mouseout).bind(c.nss.mouseout,c.id,function(a){g.settings[a.data].target=null}).unbind(c.nss.mousemove).bind(c.nss.mousemove,
c.id,function(c){var d=g.settings[c.data];c.timeStamp=(new Date).getTime();d.points.unshift(c);d.points.splice(10,1);d.target&&function(b,c,d,f){var h,l,m;h=b.fix?g.canonicalizeURL(d.href):d.href;l=b.queue;switch(!0){case !g.settings[b.id]:case g.loaded[h.replace(/#.*/,"")]:case 100<l.length:case b.interval?(new Date).getTime()-b.timestamp<b.interval:0:case b.volume>=b.limit:case b.target!==d:case b.target.protocol!==d.protocol:case b.target.host!==d.host:case a(d).is('[target="_blank"]'):case !function(a){if(3>
a.length)return!1;var b,c,d;c=a[0].timeStamp-a[1].timeStamp;b=Math.pow(a[0].pageX-a[1].pageX,2)+Math.pow(a[0].pageY-a[1].pageY,2)/(c||1);d=a[1].timeStamp-a[2].timeStamp;a=Math.pow(a[1].pageX-a[2].pageX,2)+Math.pow(a[1].pageY-a[2].pageY,2)/(d||1);switch(!0){case 100<c||100<d:return!1;case b<a+Math.pow(5,2)&&b<=Math.pow(25,2):return!0;default:return!1}}(b.points):break;default:for(;m=l.shift();)clearTimeout(m);m=setTimeout(function(){for(;m=l.shift();)clearTimeout(m);switch(!0){case !b.target:case c!==
b.points[0]:case c.pageX!==b.points[0].pageX||c.pageY!==b.points[0].pageY:break;default:b.xhr&&4>b.xhr.readyState&&b.xhr.abort();g.loaded[h.replace(/#.*/,"")]=!0;++b.volume;b.timestamp=c.timeStamp;b.lock&&(a.data(b.target,b.nss.data,"lock"),a(b.target).unbind(b.nss.click).one(b.nss.click,c.timeStamp,function(c){a(this);var f=Math.max(b.lock-(new Date).getTime()+c.data,0);f&&(a.data(d,b.nss.data,"click"),setTimeout(function(){switch(a.data(c.currentTarget,b.nss.data)){case "click":b.relay&&!1!==g.fire(b.relay,
null,[h,b.xhr])?a.removeData(c.currentTarget,b.nss.data):(b.xhr&&4>b.xhr.readyState&&b.xhr.abort(),a(c.currentTarget).removeData(b.nss.data),a(k).find(c.currentTarget)[0]&&(a(k).unbind(b.nss.click).one(b.nss.click,function(a){a.isDefaultPrevented()||(e.location.href=d.href)}),a(c.currentTarget).click()));break;default:a.removeData(c.currentTarget,b.nss.data)}},f),c.preventDefault(),c.stopPropagation())}));var f=a.extend(!0,{},b.ajax,{url:h.replace(/([^#]+)(#[^\s]*)?$/,"$1"+(b.query?(h.match(/\?/)?
"&":"?")+b.query:"")+"$2"),success:function(){g.fire(b.ajax.success,this,arguments);g.loaded[this.url.replace(/#.*/,"")]=!0;b.volume-=Number(304===arguments[2].status&&!!b.volume);switch(a.data(d,b.nss.data)){case "click":a(d).removeData(b.nss.data);a(k).find(d)[0]&&(a(k).unbind(b.nss.click).one(b.nss.click,function(a){a.isDefaultPrevented()||(e.location.href=d.href)}),a(d).click());break;default:a.removeData(d,b.nss.data)}},error:function(){g.fire(b.ajax.error,this,arguments);b.volume-=Number(!!b.volume);
a.removeData(d,b.nss.data)}});b.xhr=a.ajax(f)}},30);l.push(m)}}(d,c,d.target)});setTimeout(function(){c.volume-=Number(!!c.volume);setTimeout(arguments.callee,c.cooldown)},c.cooldown)},canonicalizeURL:function(a){var e;e=f.trim(a);e=e.replace(/[<>"{}|\\^\[\]`\s].*/,"");e=/^https?:/i.test(e)?e:h("<a/>",{href:e})[0].href;e=encodeURI(decodeURI(e));return e=e.replace(/(?:%\w+)+/g,function(e){return a.match(e.toLowerCase())||e})},trim:function(a){if(String.prototype.trim)a=String(a).trim();else if(a=String(a).replace(/^\s+/,
""))for(var e=a.length;--e;)if(/\S/.test(a.charAt(e))){a=a.substring(0,e+1);break}return a},fire:function(a,e,f,h){return"function"===typeof a?h?setTimeout(function(){a.apply(e,f)},0):a.apply(e,f):a}};(function(a,e,f,h,g){a.fn[g.name]=a[g.name]=function(){return p.apply(this,[a,e,f,h,g].concat([].slice.call(arguments)))};g.setProperties.call(a[g.name])}).apply(this,[].slice.call(arguments).concat([f]))})(jQuery,window,document,void 0);
