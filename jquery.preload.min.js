/*
 * 
 * preload
 * 
 * ---
 * @Copyright(c) 2014, falsandtru
 * @license MIT http://opensource.org/licenses/mit-license.php
 * @version 0.1.0
 * @updated 2014/02/22
 * @author falsandtru https://github.com/falsandtru/
 * @Compressor Closure Compiler
 */
(function(e,m,l,n){function p(a,b,h,e,c,d){var k=this;switch(!0){case "string"===typeof d:d={link:d};default:k=k instanceof a?k:a(h),k=c.setProperties.call(k,null,null)}var f;f=a.extend(!0,{gns:c.name,ns:e,link:"a:not([target])",filter:function(){return/(\/|\.html?|\.php)([#?].*)?$/.test(this.href)},lock:1E3,forward:null,interval:1E3,limit:2,cooldown:1E4,query:null,fix:!1,ajax:{dataType:"text",async:!0,timeout:1500}},d);f.nss={array:[c.name].concat(f.ns&&String(f.ns).split(".")||[])};a.extend(!0,
f=f.scope&&c.scope(f)||f,{id:0,nss:{name:f.ns||"",alias:c.alias?[c.alias].concat(f.nss.array.slice(1)).join("."):!1,event:f.nss.array.join("."),data:f.nss.array.join("-"),class4html:f.nss.array.join("-"),click:["click"].concat(f.nss.array.join(":")).join("."),mousemove:["mousemove"].concat(f.nss.array.join(":")).join("."),mouseover:["mouseover"].concat(f.nss.array.join(":")).join("."),mouseout:["mouseout"].concat(f.nss.array.join(":")).join(".")},target:null,volume:0,points:[],queue:[],xhr:null,timestamp:0,
option:d});a(function(){c.registrate.call(k,a,b,h,e,c,f)});return k}var g;g={name:"preload",alias:"",ids:[],settings:[0],count:0,parseHTML:null,setAlias:function(a){g.alias="string"===typeof a?a:g.alias;g.name===g.alias||e[g.alias]||(e[g.name][g.alias]=e.fn[g.name],e.fn[g.alias]=e[g.alias]=e.fn[g.name])},setProperties:function(a,b){var h=this;if(h instanceof e||h===e[g.name])h=h instanceof e&&b!==n?h.add(b):h,h[g.name]=e[g.name];return h},loaded:{},registrate:function(a,b,e,g,c,d){d.id=c.settings.length;
c.ids.push(d.id);c.settings[d.id]=d;b=d.fix?c.canonicalizeURL(b.location.href):b.location.href;c.loaded[b.replace(/#.*/,"")]=!0;this.find(d.link).filter(d.filter).unbind(d.nss.click).one(d.nss.click,d.id,function(b){var f=c.settings[b.data];b.timeStamp=(new Date).getTime();f.fix&&(this.href=c.canonicalizeURL(this.href));switch(!b.isDefaultPrevented()&&a.data(b.currentTarget,f.nss.data)){case "preload":case "lock":f.forward?(f.fix&&c.canonicalizeURL(b.currentTarget.href),!1===c.fire(f.forward,null,
[b,f.xhr,f.timeStamp])?"lock"===a.data(b.currentTarget,f.nss.data)?b.preventDefault():(c.click(f,b),a.removeData(b.currentTarget,f.nss.data)):(b.preventDefault(),a.removeData(b.currentTarget,f.nss.data))):"lock"===a.data(b.currentTarget,f.nss.data)?b.preventDefault():(c.click(f,b),a.removeData(b.currentTarget,f.nss.data));break;default:f.xhr&&4>f.xhr.readyState&&f.xhr.abort()}}).unbind(d.nss.mouseover).bind(d.nss.mouseover,d.id,function(a){c.settings[a.data].target=this}).unbind(d.nss.mouseout).bind(d.nss.mouseout,
d.id,function(a){c.settings[a.data].target=null}).unbind(d.nss.mousemove).bind(d.nss.mousemove,d.id,function(a){var b=c.settings[a.data];a.timeStamp=(new Date).getTime();b.points.unshift(a);b.points.splice(10,1);c.check(b,a,b.target)});setTimeout(function(){d.volume-=Number(!!d.volume);setTimeout(arguments.callee,d.cooldown)},d.cooldown)},check:function(a,b,h,q){var c,d,k;if(h)switch(c=a.fix?g.canonicalizeURL(b.currentTarget.href):b.currentTarget.href,d=a.queue,!0){case !g.settings[a.id]:case g.loaded[c.replace(/#.*/,
"")]:case 100<d.length:case a.interval?(new Date).getTime()-a.timestamp<a.interval:0:case a.volume>=a.limit:case a.target!==h:case a.target.protocol!==h.protocol:case a.target.host!==h.host:case e(h).is('[target="_blank"]'):case !function(a){if(3>a.length)return!1;var b,c,d;c=a[0].timeStamp-a[1].timeStamp;b=Math.pow(a[0].pageX-a[1].pageX,2)+Math.pow(a[0].pageY-a[1].pageY,2)/(c||1);d=a[1].timeStamp-a[2].timeStamp;a=Math.pow(a[1].pageX-a[2].pageX,2)+Math.pow(a[1].pageY-a[2].pageY,2)/(d||1);switch(!0){case 100<
c||100<d:return!1;case b<a+Math.pow(5,2)&&b<=Math.pow(25,2):return!0;default:return!1}}(a.points):break;default:for(;k=d.shift();)clearTimeout(k);k=setTimeout(function(){for(;k=d.shift();)clearTimeout(k);switch(!0){case !a.target:case b!==a.points[0]:case b.pageX!==a.points[0].pageX||b.pageY!==a.points[0].pageY:break;default:a.xhr&&4>a.xhr.readyState&&a.xhr.abort();g.loaded[c.replace(/#.*/,"")]=!0;++a.volume;a.timeStamp=b.timeStamp;e.data(a.target,a.nss.data,"preload");a.lock&&(e.data(a.target,a.nss.data,
"lock"),e(a.target).one(a.nss.click,b.timeStamp,function(b){if(e.data(b.currentTarget,a.nss.data)){e(this);var c=Math.max(a.lock-(new Date).getTime()+b.data,0);e.data(b.currentTarget,a.nss.data,"click");c&&(setTimeout(function(){"click"===e.data(b.currentTarget,a.nss.data)&&g.click(a,b);e.removeData(b.currentTarget,a.nss.data)},c),b.preventDefault())}}));var f=e.extend(!0,{},a.ajax,{url:c.replace(/([^#]+)(#[^\s]*)?$/,"$1"+(a.query?(c.match(/\?/)?"&":"?")+a.query:"")+"$2"),success:function(){g.fire(a.ajax.success,
this,arguments);g.loaded[this.url.replace(/#.*/,"")]=!0;a.volume-=Number(304===arguments[2].status&&!!a.volume);"click"===e.data(b.currentTarget,a.nss.data)&&g.click(a,b);e.removeData(b.currentTarget,a.nss.data)},error:function(){g.fire(a.ajax.error,this,arguments);a.volume-=Number(!!a.volume);e.removeData(h,a.nss.data)}});a.xhr=e.ajax(f)}},30);d.push(k)}},click:function(a,b){var h=b.currentTarget;a.xhr&&4>a.xhr.readyState&&a.xhr.abort();e(b.currentTarget).removeData(a.nss.data);e(l).find(b.currentTarget)[0]&&
(e(l).unbind(a.nss.click).one(a.nss.click,function(b){b.isDefaultPrevented()||(m.location.href=a.fix?g.canonicalizeURL(h.href):h.href)}),e(b.currentTarget).click());b.preventDefault()},canonicalizeURL:function(a){var b;b=g.trim(a);b=b.replace(/[<>"{}|\\^\[\]`\s].*/,"");b=/^https?:/i.test(b)?b:e("<a/>",{href:b})[0].href;b=encodeURI(decodeURI(b));return b=b.replace(/(?:%\w{2})+/g,function(b){return a.match(b.toLowerCase())||b})},trim:function(a){if(String.prototype.trim)a=String(a).trim();else if(a=
String(a).replace(/^\s+/,""))for(var b=a.length;--b;)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a},fire:function(a,b,e,g){return"function"===typeof a?g?setTimeout(function(){a.apply(b,e)},0):a.apply(b,e):a}};(function(a,b,e,g,c){a.fn[c.name]=a[c.name]=function(){return p.apply(this,[a,b,e,g,c].concat([].slice.call(arguments)))};c.setProperties.call(a[c.name])}).apply(this,[].slice.call(arguments).concat([g]))})(jQuery,window,document,void 0);
